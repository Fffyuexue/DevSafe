# DevSafe 模块说明文档（中文）

## 一、模块概述

**DevSafe** 是一款由 **春日ユズキ（Kasuga Yuzuki）** 开发的  
用于 **Android 设备镜像分区保护** 的 **KernelPatchModule（以下简称 KPM）** 模块。

该模块旨在防止设备运行过程中镜像分区被恶意或异常篡改，从而避免可能造成的  
**不可逆系统损坏或金钱损失**。  
其定位为一款以**安全性与功能性为核心目标**的底层防护模块。

DevSafe 可运行于支持 KPM 的 Root 实现环境中，例如：

- FolkPatch  
- APatch  

用户可根据自身需求选择将其 **嵌入** 或 **动态加载**。

---

## 二、术语与范围声明

本文档中所提及的 **“镜像分区”**，特指 Android 系统中的  
**`/dev/block`** 设备节点及其所映射的底层块设备分区。

所有关于写入、拦截、防护或修改镜像分区的描述，  
**均严格限定于 `/dev/block` 及其关联的实际镜像分区范围**，  
不包含用户数据分区或其他非块设备路径。

在执行任何涉及 `/dev/block` 的操作前，请充分理解其潜在风险，  
并确保已正确配置 DevSafe 的运行参数。

---

## 三、工作机制与使用原则

在 **正常情况下**，当 DevSafe 模块被启用后：

- 模块会自动拦截对镜像分区的异常写入  
- 用户无需进行任何额外干预  

但在某些 **必须写入镜像分区的合法场景** 下，  
需要通过 **传递运行参数** 的方式对模块行为进行调整。

---

## 四、需要调整参数的典型场景

在以下操作前，请务必正确调整 DevSafe 的运行参数：

1. 系统 OTA 更新  
2. 安装或卸载其他 KPM 模块  
3. 任何需要写入镜像分区的维护或修改操作  
4. 其他涉及底层镜像分区变更的场景  

---

## 五、参数说明（实时生效）

DevSafe 支持通过参数控制其防护状态，参数在传递后 **即时生效**。

### 参数 `"0"` —— 关闭防护

- 关闭对镜像分区写入行为的拦截  
- 系统将允许所有合法写入操作正常执行  

适用于以下场景：

- 系统 OTA 更新前  
- 安装或卸载其他 KPM 模块时  
- Root 实现需要向镜像分区写入数据的操作  

在该状态下，DevSafe 不会对任何镜像写入行为进行干预。

---

### 参数 `"1"` —— 开启防护

- 启用镜像分区写入防护  
- 恢复对异常或未授权写入行为的拦截能力  

建议在完成所有需要写入镜像分区的操作后，  
**立即重新传递参数 `"1"`**，以确保设备重新处于受保护状态。

---

## 六、更新与维护说明

由于 DevSafe 的功能具有较强的 **时效性**，  
且 **KernelPatch 当前未提供云端自动更新机制**，请注意：

- 定期访问项目的 GitHub 仓库  
- 及时检查模块更新或兼容性调整  
- 在系统或 KernelPatch 发生重大变更后，优先确认模块状态  

---

## 七、总结

DevSafe 是一款面向底层系统安全场景设计的专业防护模块。  
其正确使用依赖于用户对系统操作流程的清晰理解。

**在任何需要写入镜像分区的操作前主动关闭防护，并在操作完成后立即恢复防护，  
是保障设备安全与系统稳定运行的关键步骤。**

